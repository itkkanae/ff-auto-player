[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=c04f0cfe-3f7c-42e1-8b5a-8f5359f3ee3e
Description=auto player
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
hwndEx = Plugin.Window.SearchEx("FFXIVGAME","最终幻想XIV",0)
hwndArray = Split(hwndEx, "|")

timeSuffix = 60

DimEnv hwnd1
DimEnv a1
Dimenv borrowTime1

DimEnv hwnd2
DimEnv a2
Dimenv borrowTime2

DimEnv sync1
Dimenv sync2

sync1 = False
sync2 = False

DimEnv flag1
Dimenv flag2

flag1 = Form.CheckBox1.Value
flag2 = Form.CheckBox2.Value
If flag1 Then
    Call analyzeFile1()
End If
If flag2 Then
    Call analyzeFile2()
End If
If flag1 Then
    BeginThread A
End If
If flag2 Then
    BeginThread B
End If

Do
    Delay 1000
Loop

Sub A
    kArray = split(a1, "|")
    bound = CInt((UBound(kArray) + 1) / 2)
    If bound >= 0 Then 
        i=0
        For bound
            curtime = kArray(2 * i + 1) - 1
            curkey = kArray(2 * i)
            If curkey = 1000 and flag2 Then 
                sync1 = True
                While sync2 = False
                Wend
            Else 
                Call pressKey(hwnd1,curkey,curtime)
                sync1 = False
            End If
            i=i+1
        Next
    End If
End Sub

Sub B
    kArray = split(a2, "|")
    bound = CInt((UBound(kArray) + 1) / 2)
    If bound >= 0 Then 
        i=0
        For bound
            curtime = kArray(2 * i + 1) - 1
            curkey = kArray(2*i)
            If curkey = 1000 and flag2 Then 
                sync2 = True
                While sync1 = False
                Wend
            Else 
                Call pressKey(hwnd2, curkey, curtime)
                sync2 = False
            End If
            i=i+1
        Next
    End If
End Sub

Function analyzeFile1()
    hwnd1 = hwndArray(0)
    borrowTime1 = 0
    a1 = getText(Form.BrowseBox1.Path)
End Function

Function analyzeFile2()
    hwnd2 = hwndArray(1)
    borrowTime2 = 0
    a2 = getText(Form.BrowseBox2.Path)
End Function

Function parseKey(key)
    val = 32 //space
    If 97<=key and key<=122 Then //a-z
        val = key - 32
    ElseIf 48 <= key and key <= 57 Then //0-9
        val = key
    ElseIf 44 <= key and key <= 47 Then //,-./
        val = key+144
    ElseIf 91 <= key and key <= 93 Then //[\]
        val = key+128
    ElseIf key = 39 Then //'
        val = 222
    ElseIf key = 59 Then //;
        val = 186
    ElseIf key = 61 Then //=
        val = 187
    ElseIf key = 96 Then //`
        val = 192
    ElseIf key = 35 Then //#
        val = 1000
    End If
    parseKey = val
End Function

Function pressKey(hwnd, key, timeVal)
    Call Plugin.Bkgnd.KeyDown(hwnd,key)
    Delay timeVal
    Call Plugin.Bkgnd.KeyUp(hwnd, key)
    Delay 30
End Function

Function getText(fPath)
    fText = ""
    speed = 60000 / Form.Slider.Value
    If Plugin.File.ExistFile(fPath) Then 
        fText = Plugin.File.ReadFileEx(fPath)
        fText = LCase(Replace(fText,Chr(10),"|"))
        fText = Replace(fText,Chr(13),"|")
        While InStr(fText,"||")>0
            fText = Replace(fText,"||","|")
        Wend
        sArray = Split(fText, "|")
        bound = CInt((UBound(sArray)+1) / 2)
        If bound >= 0 Then 
            i = 0
            borrowTime = 0
            For bound
                sArray(2 * i) = parseKey(Asc(sArray(2 * i)))
                timeVal = CInt(sArray(2 * i + 1) * speed)
                If sArray(2 * i) = 1000 Then 
                    sArray(2 * i + 1) = 0
                Else 
                    If timeVal < timeSuffix Then 
                        borrowTime = borrowTime + timeSuffix - timeVal
                        timeVal = timeSuffix
                    End If
                    If timeVal > (borrowTime + timeSuffix) Then
                        timeVal = timeVal - borrowTime
                        borrowTime = 0
                    End If
                    sArray(2 * i + 1) = timeVal - 31
                End If
                i=i+1
            Next
        End If
        fText = join(sArray,"|")
    End If
    getText = fText
End Function

Event Form.Slider.Slide
    Form.SpeedLabel.Caption = Form.Slider.Value
End Event

Event Form.CheckBox1.Click
    If Form.CheckBox1.Value Then 
        If Form.BrowseBox1.Path = "" Then 
            Form.CheckBox1.Value = False
        End If
    End If
End Event

Event Form.CheckBox2.Click
    hwndEx = Plugin.Window.SearchEx("FFXIVGAME","最终幻想XIV",0)
    hwndArray = Split(hwndEx, "|")
    If Form.CheckBox2.Value Then 
        If Form.BrowseBox2.Path = "" Then 
            Form.CheckBox2.Value = False
        End If
        If UBound(hwndArray) <2 Then 
            Form.CheckBox2.Value = False
        End If
    End If
End Event
